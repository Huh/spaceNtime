---
title: "Using TTE.STE.IS"
author: "Anna K. Moeller"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using TTE.STE.IS}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The package TTE.STE.IS was created to assist with analyses described in "Three novel methods to estimate abundance of unmarked animals using remote cameras" by Moeller et al. (2018). This package helps the user create an encounter history from a database of analyzed photos and run each of the models. Each of the models (Time-to-Event, Space-to-Event, and Instantaneous Sampling) require different encounter histories and functions, so there is an example of each here. 

This is my first package and is very much in development, so it is guaranteed to have bugs. I would appreciate hearing from you if you encounter problems!

## Load the package
If you haven't already installed it, please see instructions at the bottom of my [Github repository](https://github.com/annam21/TTE.STE.IS)
```{r, message = F}
library(TTE.STE.IS)
```


## The data

### Initial database

The functions for all three methods are built from a camera database of the following form. 
```{r}
df <- data.frame(cam = c(1,1,2,2),
                 datetime = as.POSIXct(c("2016-01-02 12:00:00",
                                     "2016-01-03 13:12:00",
                                     "2016-01-02 14:00:00",
                                     "2016-01-03 16:53:42"),
                                    tz = "GMT"),
                 a = c(850, 850, 1100, 1100),
                 count = c(1, 0, 0, 2))
```
`r knitr::kable(df, caption = "df")`

As shown above, the database must contain the following columns (at a minimum, and in any order):

- cam (name must be this exactly). This is the unique ID of the sampling site. This column can be any class of object

- datetime (name must be this exactly). This is the date and time of the photo, in class POSIXct

- a (name must be this exactly). This is the viewable area of that camera at that date and time. Class numeric. This column is optional if you create your camera area database through different means than a_lookup_fn (described below)

 - count. This can actually be named anything, but should be numeric. It is the count of the study species in the photo of interest. 
 
### Camera areas 
We also need a database of the area of each camera.

```{r}
lu <- a_lookup_fn(df)
```

`r knitr::kable(lu)`
You can create this yourself or by using the function a_lookup_fn (if your database includes the column a). The important thing to note is that this should include all cameras that were functioning during the sampling period, not just ones that took pictures of the target species. Currently, this package is not built to account for cameras that were functioning during part of the sampling period or cameras whose area changes, but those are coming in future iterations.  

## Time-to-Event
This is in progress. No code yet.

## Space-to-Event
### Encounter history
To create your STE encounter history, you must define the first and last days of your study period, and then use the function ste_data_fn (see its documentation for more details)(i.e., `?ste_data_fn`).
```{r}
dates <- as.POSIXct(c("2016-01-01 00:00:00", "2016-01-04 23:59:59"), tz = "GMT")
dat.ste <- ste_data_fn(df,
                       count_col = "count",
                       samp = 3600,
                       samp_length = 10,
                       cam_areas = lu,
                       date_lim = dates,
                       A = 150000)
```

### Estimate abundance
To estimate abundance from STE, use the function ste_estN_fn
```{r}
ste_estN_fn(dat.ste)
```
This will always produce a warning about Nelder-Mead. In future versions of this package, you may be able to change your optimization method. 


## Instantaneous Sampling.
This is in progress. No code yet. 

